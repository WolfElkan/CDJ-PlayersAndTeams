<!DOCTYPE html>
<html ng-app='app'>
	<head>
		<link rel="stylesheet" type="text/css" href="static/dojo-table.css">
		<style type="text/css">
			
			.fix {
				width: 120px;
			}

		</style>
		<script type="text/javascript" src="angular/angular.js"></script>
		<script type="text/javascript" src="angular-route/angular-route.js"></script>
		<script type="text/javascript">
			
		var app = angular.module('app', ['ngRoute'])
		app.config(function($routeProvider) {
			$routeProvider.when('/players',{
				templateUrl: 'partials/players.html',
				controller:  'players_cxr'
			})
			$routeProvider.when('/teams',{
				templateUrl: 'partials/teams.html',
				controller:  'teams_cxr'
			})
			$routeProvider.when('/player~team',{
				templateUrl: 'partials/player~team.html',
				controller:  'player_team_m2m_cxr'
			})
			$routeProvider.otherwise({
				redirectTo: '/players'
			})
		})

		var PlayerFactory = app.factory('PlayerFactory',[function() {
			var factory = {}
			var stuff = []
			factory.new = {}
			var next_id = 1

			factory.all = function() {
				return stuff
			}

			factory.find = function(id) {
				for (var i = 0; i < stuff.length; i++) {
					if (stuff[i].id == id) {
						return stuff[i]
					}
				}
			}

			factory.add = function() {
				factory.new.id = next_id++
				stuff.push(factory.new)
				factory.new = {}
			}

			factory.delete = function(index) {
				for (var i = index; i < stuff.length; i++) {
					stuff[i] = stuff[i+1]
				}
				stuff.pop()
			}

			return factory
		}])

		var players_cxr = app.controller('players_cxr',['$scope','PlayerFactory',function($scope,PlayerFactory) {
			$scope.Player = PlayerFactory
		}])

		var TeamFactory = app.factory('TeamFactory',[function() {
			var factory = {}
			var stuff = []
			factory.new = {}
			var next_id = 1

			factory.all = function() {
				return stuff
			}

			factory.find = function(id) {
				for (var i = 0; i < stuff.length; i++) {
					if (stuff[i].id == id) {
						return stuff[i]
					}
				}
			}

			factory.add = function() {
				factory.new.id = next_id++
				stuff.push(factory.new)
				factory.new = {}
			}

			factory.delete = function(index) {
				for (var i = index; i < stuff.length; i++) {
					stuff[i] = stuff[i+1]
				}
				stuff.pop()
			}

			return factory
		}])

		var teams_cxr = app.controller('teams_cxr',['$scope','TeamFactory',function($scope,TeamFactory) {
			$scope.Team = TeamFactory
		}])

		var PlayerTeamJoinery = app.factory('PlayerTeamJoinery',['PlayerFactory','TeamFactory',function(PlayerFactory,TeamFactory) {
			var factory = {}
			var stuff = []
			factory.new = {}
			var next_id = 1

			factory.all = function() {
				return stuff
			}

			factory.find = function(id) {
				for (var i = 0; i < stuff.length; i++) {
					if (stuff[i].id == id) {
						return stuff[i]
					}
				}
			}

			factory.add = function() {
				factory.new.id = next_id++
				factory.new.player = function() {
					return PlayerFactory.find(this.player_id)
				}
				factory.new.team = function() {
					return TeamFactory.find(this.team_id)
				}
				stuff.push(factory.new)
				factory.new = {}
			}

			factory.delete = function(index) {
				for (var i = index; i < stuff.length; i++) {
					stuff[i] = stuff[i+1]
				}
				stuff.pop()
			}

			return factory
		}])

		var player_team_m2m_cxr = app.controller('player_team_m2m_cxr',['$scope','PlayerTeamJoinery','PlayerFactory','TeamFactory',function($scope,PlayerTeamJoinery,PlayerFactory,TeamFactory) {
			$scope.Joinery = PlayerTeamJoinery
			$scope.Player = PlayerFactory
			$scope.Team = TeamFactory
		}])

		</script>
	</head>

	<body>
	<h1 ng-if="false">Error: Cannot Run Angular</h1>
	<a href="#!/players">Players</a>
	<a href="#!/teams">Teams</a>
	<a href="#!/player~team">Associations</a>
	<div ng-view></div>
	</body>
</html>
